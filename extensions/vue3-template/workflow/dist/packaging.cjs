"use strict";var D=Object.create;var h=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var N=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of $(e))!b.call(n,s)&&s!==t&&h(n,s,{get:()=>e[s],enumerable:!(i=E(e,s))||i.enumerable});return n};var m=(n,e,t)=>(t=n!=null?D(S(n)):{},N(e||!n||!n.__esModule?h(t,"default",{value:n,enumerable:!0}):t,n));var J=m(require("archiver"),1),l=m(require("fs-extra"),1),g=m(require("path"),1);const w=n=>n==="free";function F(n={}){const e=n;return{package_version:e.package_version??"1.0.0",name:e.name??"Default Extension",version:e.version??"1.0.0",author:e.author??"Unknown",editor:e.editor??"Unknown",description:e.description??"No description provided.",main:e.main??"index.js",panels:e.panels??{},contributions:e.contributions??{}}}function O(n,e="full"){var i;const t=F(n);if(w(e)){const s=t.name,c=`${t.name}-free`;t.name=c,t.description=t.description.replace(s,c);for(const o in t.panels)t.panels.hasOwnProperty(o)&&(t.panels[o].title=t.panels[o].title.replace(s,c));(i=t.contributions.menu)==null||i.forEach(o=>{o.path=o.path.replace(s,c),o.label=o.label.replace(s,c),o.path=o.path.replace("editor_menu","editor_menu_free")})}return t}function _(n,e,t){return new Promise((i,s)=>{const c=g.dirname(e);l.ensureDirSync(c);const o=l.createWriteStream(e),p=(0,J.default)("zip",{zlib:{level:9}});o.on("close",()=>{console.log(`Package created: ${e}`),i()}),p.on("warning",r=>{r.code!=="ENOENT"&&console.warn(`Warning: ${r.message}`)}),p.on("error",r=>{s(new Error(`Error creating zip: ${r.message}`))}),n.forEach(r=>{const P=r.type,d=t?g.posix.join(t,r.name):r.name;if(P==="content"){const a=r.content;a?p.append(a,{name:d}):console.error(`Invalid content: ${d}`)}else{const a=r.path;a?l.existsSync(a)?l.statSync(a).isDirectory()?p.directory(a,d):p.file(a,{name:d}):console.error(`Path does not exist: ${d}`):console.error(`Invalid path: ${d}`)}}),p.pipe(o),p.finalize()})}function z(n){try{l.existsSync(n)&&(console.log(`Deleting old package: ${n}`),l.removeSync(n))}catch(e){console.error(`Failed to delete old package: ${e.message}`)}}const T=n=>{const e=process.argv,t=e.indexOf(`--${n}`);return t!==-1?e[t+1]:void 0},j=T("prod")??"full",u=g.resolve(process.cwd(),".."),v="package.json",V=g.resolve(u,v),y="dist",I=g.resolve(u,y),k="i18n",R=g.resolve(u,k),U=JSON.parse(l.readFileSync(V,"utf-8")),f=O(U,j),W=`${f.name}.zip`,x=g.resolve(u,"publish",W),A=[{type:"content",name:v,content:JSON.stringify(f,null,2)},{type:"path",name:y,path:I},{type:"path",name:k,path:R}];z(x),_(A,x,f.name).then(()=>console.log("Successfully generated package!")).catch(n=>console.error(`Failed to generate package: ${n.message}`));
